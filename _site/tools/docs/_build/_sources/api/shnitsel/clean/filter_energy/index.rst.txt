shnitsel.clean.filter_energy
============================

.. py:module:: shnitsel.clean.filter_energy


Attributes
----------

.. autoapisummary::

   shnitsel.clean.filter_energy._default_energy_thresholds_eV


Functions
---------

.. autoapisummary::

   shnitsel.clean.filter_energy.energy_filtranda
   shnitsel.clean.filter_energy.sanity_check


Module Contents
---------------

.. py:data:: _default_energy_thresholds_eV

.. py:function:: energy_filtranda(frames, *, etot_drift = None, etot_step = None, epot_step = None, ekin_step = None, hop_epot_step = None, units='eV')

   Derive energetic filtration targets from an xr.Dataset

   :param frames: A xr.Dataset with ``astate``, ``energy``, and ideally ``e_kin`` variables
   :param etot_drift: Threshold for drift of total energy over an entire trajectory, by default 0.2 eV
   :param optional: Threshold for drift of total energy over an entire trajectory, by default 0.2 eV
   :param etot_step: Threshold for difference in total energy from one frame to the next, ignoring hops
                     , by default 0.1 eV
   :param optional: Threshold for difference in total energy from one frame to the next, ignoring hops
                    , by default 0.1 eV
   :param epot_step: Threshold for difference in potential energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param optional: Threshold for difference in potential energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param ekin_step: Threshold for difference in kinetic energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param optional: Threshold for difference in kinetic energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param hop_epot_step: Threshold for difference in potential energy across hops, by default 1.0 eV
   :param optional: Threshold for difference in potential energy across hops, by default 1.0 eV
   :param units: Units in which custom thresholds are given, and to which defaults and data will be converted, by default 'eV'
   :param optional: Units in which custom thresholds are given, and to which defaults and data will be converted, by default 'eV'

   :returns: * An xr.DataArray of filtration targets stacked along the ``criterion`` dimension;
             * *criteria comprise epot_step and hop_epot_step, as well as*
             * *etot_drift, etot_step and ekin_step if the input contains an e_kin variable*


.. py:function:: sanity_check(frames, cut = 'truncate', *, units='eV', etot_drift = np.nan, etot_step = np.nan, epot_step = np.nan, ekin_step = np.nan, hop_epot_step = np.nan, plot_thresholds = False, plot_populations = False)

   Filter trajectories according to energy to exclude unphysical (insane) behaviour

   :param frames: A xr.Dataset with ``astate``, ``energy``, and ideally ``e_kin`` variables
   :param cut:
               Specifies the manner in which to remove data;

                   - if 'omit', drop trajectories unless all frames meet criteria (:py:func:`shnitsel.clean.omit`)
                   - if 'truncate', cut each trajectory off just before the first frame that doesn't meet criteria
                     (:py:func:`shnitsel.clean.truncate`)
                   - if a number, interpret this number as a time, and cut all trajectories off at this time,
                     discarding those which violate criteria before reaching the given limit,
                     (:py:func:`shnitsel.clean.transect`)
                   - if ``False``, merely annotate the data;
               see :py:func:`shnitsel.clean.dispatch_cut`.
   :param optional:
                    Specifies the manner in which to remove data;

                        - if 'omit', drop trajectories unless all frames meet criteria (:py:func:`shnitsel.clean.omit`)
                        - if 'truncate', cut each trajectory off just before the first frame that doesn't meet criteria
                          (:py:func:`shnitsel.clean.truncate`)
                        - if a number, interpret this number as a time, and cut all trajectories off at this time,
                          discarding those which violate criteria before reaching the given limit,
                          (:py:func:`shnitsel.clean.transect`)
                        - if ``False``, merely annotate the data;
                    see :py:func:`shnitsel.clean.dispatch_cut`.
   :param units: Units in which custom thresholds are given, and to which defaults and data will be converted, by default 'eV'
   :param optional: Units in which custom thresholds are given, and to which defaults and data will be converted, by default 'eV'
   :param etot_drift: Threshold for drift of total energy over an entire trajectory, by default 0.2 eV
   :param optional: Threshold for drift of total energy over an entire trajectory, by default 0.2 eV
   :param etot_step: Threshold for difference in total energy from one frame to the next, ignoring hops
                     , by default 0.1 eV
   :param optional: Threshold for difference in total energy from one frame to the next, ignoring hops
                    , by default 0.1 eV
   :param epot_step: Threshold for difference in potential energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param optional: Threshold for difference in potential energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param ekin_step: Threshold for difference in kinetic energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param optional: Threshold for difference in kinetic energy from one frame to the next, ignoring hops, by default 0.7 eV
   :param hop_epot_step: Threshold for difference in potential energy across hops, by default 1.0 eV
   :param optional: Threshold for difference in potential energy across hops, by default 1.0 eV
   :param plot_thresholds: See :py:func:`shnitsel.vis.plot.filtration.check_thresholds`.

                           - If ``True``, will plot using ``check_thresholds`` with
                           default quantiles
                           - If a ``Sequence``, will plot using ``check_thresholds``
                           with specified quantiles
                           - If ``False``, will not plot threshold plot
   :param plot_populations: See :py:func:`shnitsel.vis.plot.filtration.validity_populations`.

                            - If ``True`` or ``'intersections'``, will plot populations of
                            trajectories satisfying intersecting conditions
                            - If ``'independent'``, will plot populations of
                            trajectories satisfying conditions taken independently
                            - If ``False``, will not plot populations plot

   :rtype: The sanitized xr.Dataset


