shnitsel.bridges
================

.. py:module:: shnitsel.bridges

.. autoapi-nested-parse::

   This submodule contains functions used to interface with other packages and programs, especially RDKit.



Attributes
----------

.. autoapisummary::

   shnitsel.bridges.default_mol


Functions
---------

.. autoapisummary::

   shnitsel.bridges.to_xyz
   shnitsel.bridges.traj_to_xyz
   shnitsel.bridges.to_mol
   shnitsel.bridges.numbered_smiles_to_mol
   shnitsel.bridges._most_stable_frame
   shnitsel.bridges.construct_default_mol
   shnitsel.bridges.smiles_map


Module Contents
---------------

.. py:function:: to_xyz(da, comment='#', units='angstrom')

   Convert an xr.DataArray of molecular geometry to an XYZ string

   :param da: A molecular geometry -- should have dimensions 'atom' and 'direction'
   :param comment: The comment line for the XYZ, by default '#'
   :param units: The units to which to convert before creating the XYZ string

   :rtype: The XYZ data as a string

   .. rubric:: Notes

   The units of the outputs will be the same as the array;
   consider converting to angstrom first, as most tools will expect this.


.. py:function:: traj_to_xyz(traj_atXYZ, units='angstrom')

   Convert an entire trajectory's worth of geometries to an XYZ string

   :param traj_atXYZ: Molecular geometries -- should have dimensions 'atom' and 'direction'; should
                      also be groupable by 'time' (i.e. either have a 'time' dimension or
                      a 'time' coordinate)
   :param units: The units to which to convert before creating the XYZ string

   :rtype: The XYZ data as a string, with time indicated in the comment line of each frame

   .. rubric:: Notes

   The units of the outputs will be the same as the array;
   consider converting to angstrom first, as most tools will expect this.


.. py:function:: to_mol(atXYZ_frame, charge = None, covFactor = 1.2, to2D = True, molAtomMapNumber = None, atomNote = None, atomLabel = None)

   Convert a single frame's geometry to an RDKit Mol object

   :param atXYZ_frame: The ``xr.DataArray`` object to be converted; must have 'atom' and 'direction' dims,
                       must not have 'frame' dim.
   :param charge: Charge of the molecule, used by RDKit to determine bond orders; if ``None`` (the default),
                  this function will try ``charge=0`` and leave the bond orders undetermined if that causes
                  an error; otherwise failure to determine bond order will raise an error.
   :param covFactor: Scales the distance at which atoms are considered bonded, by default 1.2
   :param to2D: Discard 3D information and generate 2D conformer (useful for displaying), by default True
   :param molAtomMapNumber: Set the ``molAtomMapNumber`` properties to values provided in a list,
                            or (if ``True`` is passed) set the properties to the respective atom indices
   :param atomNote: Behaves like the ``molAtomMapNumber`` parameter above, but for the ``atomNote`` properties
   :param atomLabel: Behaves like the ``molAtomMapNumber`` parameter above, but for the ``atomLabel`` properties

   :rtype: An RDKit Mol object

   :raises ValueError: If ``charge`` is not ``None`` and bond order determination fails


.. py:function:: numbered_smiles_to_mol(smiles)

   Convert a numbered SMILES-string to a analogically-numbered Mol object

   :param smiles: A SMILES string in which each atom is associated with a mapping index,
                  e.g. '[H:3][C:1]#[C:0][H:2]'
   :type smiles: str

   :returns: * An :py:func:`rdkit.Chem.Mol` object with atom indices numbered according
             * *to the indices from the SMILES-string*


.. py:function:: _most_stable_frame(atXYZ, obj)

   Find the frame, out of all the initial conditions,
   with the lowest ground-state energy;
   failing that, return the first frame in ``atXYZ``


.. py:function:: construct_default_mol(obj, to2D = True, charge = None, molAtomMapNumber = None, atomNote = None, atomLabel = None, silent_mode = False)

   Try many ways to get a representative Mol object for an ensemble:

       1. Use the ``mol`` attr (of either obj or obj['atXYZ']) directly
       2. Feed the ``smiles_map`` attr (of either ``obj`` or ``obj['atXYZ']``) to
       :py:func:`shnitsel.bridges.default_mol`
       3. Take the geometry from the first frame of the molecule and the charge specified in the
       ``charge`` attr (charge=0 assumed if not specified) and feed these to
       :py:func:`shnitsel.bridges.to_mol`

   :param obj: An 'atXYZ' xr.DataArray with molecular geometries
               or an xr.Dataset containing the above as one of its variables
               or an rc.Mol object that will just be returned.
   :type obj: xr.Dataset | xr.DataArray | Trajectory | Frames | rc.Mol
   :param to2D: Discard 3D information and generate 2D conformer (useful for displaying), by default True
   :type to2D: bool, optional
   :param charge: Optional parameter to set the charge of the molecule if not present within the molecule data.
                  If provided as an int, will be interpreted as number of elemental charges.
                  Float will be converted to int and interpreted the same way.
                  If not provided, will attempt to extract charge info from the xarray or Mol object and
                  default to 0 charge if none can be found.
   :type charge: int, float or None, optional
   :param molAtomMapNumber: Set the ``molAtomMapNumber`` properties to values provided in a list,
                            or (if ``True`` is passed) set the properties to the respective atom indices
   :type molAtomMapNumber: list[str] | Literal[True], optional
   :param atomNote: Behaves like the ``molAtomMapNumber`` parameter above, but for the ``atomNote`` properties
   :type atomNote: list[str] | Literal[True], optional
   :param atomLabel: Behaves like the ``molAtomMapNumber`` parameter above, but for the ``atomLabel`` properties
   :type atomLabel: list[str] | Literal[True], optional
   :param silent_mode: Flag to disable logging outputs. Used for internal constructions of molecular structures.
                       By default, status of mol construction is logged (i.e. ``silent_mode=False``).
   :type silent_mode: bool, optional

   :rtype: An rdkit.Chem.Mol object

   :raises ValueError: If the final approach fails

   .. rubric:: Notes

   If this function uses an existing ``Mol`` object, it returns a copy.
   One consequence is that the decoration parameters
   ``molAtomMapNumber``, ``atomNote`` and ``atomLabel``
   do not affect the existing ``Mol`` object.


.. py:function:: smiles_map(atXYZ_frame, charge=0, covFactor=1.5)

   Convert a geometry to a SMILES-string, retaining atom order

   :param atXYZ_frame: An xr.DataArray of molecular geometry
   :param charge: The charge of the molcule, by default 0
   :param optional: The charge of the molcule, by default 0
   :param covFactor: Scales the distance at which atoms are considered bonded, by default 1.5
   :param optional: Scales the distance at which atoms are considered bonded, by default 1.5

   :returns: * *A SMILES-string in which the mapping number indicates the order in which the*
             * **atoms appeared in the input matrix, e.g. '[H** (*3][C:1]#[C:0][H:2]'*)


.. py:data:: default_mol

